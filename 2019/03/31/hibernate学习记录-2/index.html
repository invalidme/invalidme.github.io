<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content>
  <meta name="author" content="zhang">
  <!-- Open Graph Data -->
  <meta property="og:title" content="hibernate学习记录-2">
  <meta property="og:description" content>
  <meta property="og:site_name" content="Hexo">
  <meta property="og:type" content="article">
  <meta property="og:image" content="http://yoursite.com">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>Hexo</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">hibernate学习记录-2</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/<your-github-username>">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:<your-email-address>">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By zhang</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2019-03-31</span>
            <span class="time">16:11:42</span>
          </span>
          
        </div>
        <!-- Tags -->
        
        <!-- Post Main Content -->
        <div class="post-content">
          <p>——–实体类的编写规则(对应hibernate_1中的2.创建实体类)——–<br>1.实体类里的属性私有<br>2.私有属性使用公开的set和get方法操作<br>3.实体类里要有属性作为唯一值（一般使用id）<br>4.实体类属性不建议使用基本数据类型，而使用基本数据类型对应的包装类<br>(1)八个基本数据类型对应的包装类<br>int-Integer<br>char-Character<br>其他的都是首字母大写（如double-Double）<br>(2)学生分数的表示：int score =0 仅能表示得0分<br>                               Integer=0，得0分；Integer=null，缺考<br>-实体类的操作<br>对实体类crud操作<br>添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user u=new user();</span><br><span class="line">u.setName(&quot;小张&quot;);</span><br><span class="line">u.setPwd(&quot;12345&quot;);</span><br><span class="line">u.setAddress(&quot;意大利&quot;);</span><br><span class="line">session.save(u);</span><br></pre></td></tr></table></figure></p>
<p>根据id查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User u=session.get(User.class，1);//第一个参数：实体类的class    第二个参数：id值</span><br><span class="line">                                                   //实体类中加上toString方法</span><br></pre></td></tr></table></figure></p>
<p>修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User u=session.get(User.class,1);</span><br><span class="line">u.setName(&quot;自行车&quot;);</span><br><span class="line">session.update(u);//执行过程：到u对象里找到id值，设置返回对象的值，调用方法实现</span><br></pre></td></tr></table></figure></p>
<p>删除<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User u=session.get(User.class,1);</span><br><span class="line">session.delete(u);</span><br><span class="line">或</span><br><span class="line">User u =new User();</span><br><span class="line">u.setId(3);</span><br><span class="line">session.delete(u);</span><br></pre></td></tr></table></figure></p>
<p>实现类对象的状态(理解)<br>(1)瞬时态：对象里没有id值，对象与session没有关联<br><img src="/2019/03/31/hibernate学习记录-2/瞬时态.PNG"><br>(2)持久态：对象里有id值，对象与session关联<br><img src="/2019/03/31/hibernate学习记录-2/持久态.PNG"><br>(3)托管态：对象有id值，对象与session没有关联<br><img src="/2019/03/31/hibernate学习记录-2/托管态.PNG"><br>以上接saveOrUpdate方法：既能实现添加，也能实现修改<br>瞬时态+saveOrUpdate：实现添加<br>持久态+saveOrUpdate：实现修改(可以不需要saveOrUpdate就把数据更新到数据库)<br>托管态+saveOrUpdate：实现修改</p>
<p>——–hibernate事务操作——–<br>事务的相关概念<br>1.什么是事务？hibernate学习记录_1<br>2.事务的特性？hibernate学习记录_1<br>3不考虑隔离性所产生的问题<br>脏读      不可重复读     虚读<br>解决:设置事务的隔离级别<br>-mysql默认的隔离级别 repeatable_read:对相同字段的读取是一致的<br>事务代码规范写法（重要）<br>1.代码结构<br>try{<br>开启事务<br>提交事务<br>}catch(){<br>回滚事务<br>}finally{<br> 关闭操作<br>}<br><img src="/2019/03/31/hibernate学习记录-2/事务规范代码.PNG"></p>
<p>Hibernate绑定session<br>1.session类似于jdbc的connection<br>2.hibernate框架帮我们实现与本地线程绑定session<br>3.获取与本地线程session<br>-在hibernate核心配置文件中配置<br><img src="/2019/03/31/hibernate学习记录-2/在核心配置文件中配置.PNG"><br>-调用sessionFactory里面的方法得到<br><img src="/2019/03/31/hibernate学习记录-2/调用sessionFactory里的方法.PNG"><br>测试：<br><img src="/2019/03/31/hibernate学习记录-2/测试.PNG"><br>4.获取与本地线程绑定session的时候，关闭了session以至于报错:org.hibernate.SessionException: Session was already closed<br>解决：不需要手动关闭session<br>注意：写Session session=sessionFactory.openSession();   要手动关闭</p>
<p>——–Hibernate的api使用——–<br>Query对象<br>1.使用query对象，不需要写sql语句，但要写hql语句<br>-hql：hibernate query language ：是hibernate提供的查询语言<br>-hql和sql的区别：使用sql来操作表和字段，而使用hql操作实体类和属性<br>2.查询所有hql语句：from 实体类的名称<br>3.怎么使用Query对象？<br>-创建Query对象<br>-调用Query对象里的方法来操作<br><img src="/2019/03/31/hibernate学习记录-2/query.PNG"><br>Criteria对象<br>1.查询操作，但是使用这个对象的时候，不需要写语句，直接调用方法实现<br>怎么使用Criteria对象？<br>-创建Criteria对象<br>-调用Criteria对象里的方法来操作<br><img src="/2019/03/31/hibernate学习记录-2/criteria.PNG"><br>SQLQuery对象<br>1.使用hibernate的时候，想用底层sql语句，可用SQLQuery对象来实现<br>怎么使用SQLQuery对象<br>-创建SQLQuery对象<br>-调用SQLQuery对象里的方法来操作<br>First<br><img src="/2019/03/31/hibernate学习记录-2/sqlquery2.PNG"><br>Second<br><img src="/2019/03/31/hibernate学习记录-2/sqlquery.PNG"></p>
<p>——–hibernate主键生成策略(对应hibernate_1中的3.创建hibernate配置映射文件)——–<br>1.hibernate要求实体类有一个属性(对应唯一字段)的值唯一，对应表主键，主键可以有不同的生成策略<br>2.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 设置表内id增长策略,native:生成表id就会自动增长 --&gt;</span><br><span class="line">   &lt;generator class=&quot;native&quot;&gt;&lt;/generator&gt;</span><br></pre></td></tr></table></figure></p>
<p>native：自适应不同数据库<br>uuid：使用uuid的生成策略,实体类id属性必须是字符串类型<br>        private String id;<br>且hibernate映射文件里<br>     <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;generator class=&quot;uuid&quot; /&gt;</span><br></pre></td></tr></table></figure></p>
<p>——–Hibernate一级缓存——–<br>什么是缓存？<br>1.数据存到数据库里，数据库本身是文件系统，使用流方式操作文件效率低<br>  -可以把数据存到内存里面，不需要使用流方式，可以直接读取内存中的数据<br>  -把数据存到内存中，提高读取效率<br>hibernate缓存<br>1.hibernate框架提供很多优化方式（如hibernate缓存）<br>2.hibernate缓存特点：<br>  -hibernate一级缓存（重要）<br>    (1)hibernate一级缓存默认打开<br>    (2)hibernate一级缓存使用范围就是session的范围:从session创建到session关闭<br>    (3)hibernate一级缓存中，存储数据必须是持久态数据<br>  -hibernate二级缓存（了解）<br>    (1)目前已经不使用了，用redis技术代替<br>    (2)不是默认打开的，需要配置<br>    (3)使用范围，是sessionFactory范围<br>验证一级缓存的存在<br>验证方式：<br>1.先根据id=1查询，返回对象  查数据库<br>2.再根据id=1查询，返回对象  不再查数据库，直接查缓存<br><img src="/2019/03/31/hibernate学习记录-2/断点1.PNG"><br><img src="/2019/03/31/hibernate学习记录-2/断点2.PNG"></p>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        </p><p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

